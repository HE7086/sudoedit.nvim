# sudoedit.nvim
Let nvim detect filetype properly when used with **sudoedit**

* This plugin detects the parent process' cmdline. When nvim is spawned by `sudoedit`, `sudo -e` or `sudo --edit`, it will trigger filetype detection based on the original filename, instead of the temporary file generated by `sudoedit`.
* Enjoy editing system configuration files with proper syntax highlighting :)
* Only supports Linux and BSD (untested)

## installation
* Lazy.nvim
```lua
-- for normal Linux users the plugin works out-of-box
{ "HE7086/sudoedit.nvim" }
```

## configuration
```lua
{
  "HE7086/sudoedit.nvim",
  -- If you are sharing the same config on different platforms, you might want to disable the plugin for unsupported systems.
  enabled = function()
    return vim.fn.has("linux") == 1
  end,
  opts = {
    -- It seems that some versions of sudoedit spawns nvim as a child instead of a "grandchild" as on my machine. If this is the case for you, enable `parent = true`.
    parent = true,

    -- default filename to use if nothing is detected, useful for statusline
    -- see `:h stl`
    filename = "%F",
  }
}
```

## get filename for statusline
* If you would like to display the actual filename in statusline (winbar, etc.), you can get that using:
```lua
-- leave args empty for current buffer, or bufnr for specific buffer
require("sudoedit").get_filename()
```
* Fallback: `%F`

### example statusline component using heirline.nvim
```lua
{ -- filename
  provider = function(self)
    return require("sudoedit").get_filename(self.bufnr)
  end,
},

{ -- sudoedit indicator
  provider = "[sudo]",
  condition = function(self)
    return require("sudoedit").detected(self.bufnr)
  end,
},
```

## credits
[vim-eunuch](https://github.com/tpope/vim-eunuch)

## FAQ
* This plugin does not work, if:
  * nvim is spawned by `sudo -E nvim <filename>` instead of `sudoedit <filename>`.
  * the filetype cannot be determined even without `sudoedit`.
  * the file is a symlink -- `sudoedit` does not allow editing symlinks.
  * the file is in a writable directory -- `sudoedit` does not allow that too.
  * you are using MacOS -- its `sudo` does not support `sudoedit`.
  * you are using other OSs -- Windows, Sun ... idk.
  * you are using other permission management tools like `doas`, `run0`.

* Why `sudoedit` instead of `sudo -E nvim`?
  * The main problem with the latter option is it spawns nvim as root. In order for nvim to still load plugins `-E` flags is used. That will cause nvim to write temporary files in your home directory as root. If you ever want to clean up some disk space you will find a lot of files owned by root in `~/.local/state/nvim`, `~/.cache/nvim`, etc. Not to mention if you accidentally updated plugins while nvim is running as root.
  * However you must quit nvim entirely for `sudoedit` to actually write your modification back to the original file.

* I'm so used to typing `sudo -E nvim`, I can't adapt to sudoedit.
```bash
sudo() {
    case $1 in 
        vi|vim|nvim) command sudoedit "${@:2}";;
        *) command sudo "$@";;
    esac
}
alias sudo "sudo " # note the important trailing space
```

* How much time does the plugin take at startup?
  * < 0.1ms per file.

* Note: currently there might be some edge cases where actual filename is not detected correctly. Mainly when editing multiple files at a time, i.e. `sudoedit file1 file2 ...`. To get around this, always edit one file at a time.
